<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>ðŸ’– Gá»­i Em</title>
    <style>
        body {
            margin: 0;
            background: #fff0f5;
            font-family: 'Segoe UI', sans-serif;
            overflow: hidden;
        }

        .text-box {
            font-size: 2rem;
            color: #d6336c;
            min-height: 3em;
            text-align: center;
            margin-top: 80px;
            position: relative;
            z-index: 2;
        }

        canvas {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }
    </style>
</head>
<body>

<div class="text-box" id="textBox"></div>
<canvas id="heartCanvas"></canvas>

<script>
    const lines = [
        "Anh biáº¿t há»i trá»±c tiáº¿p hÆ¡i khÃ³...",
        "nÃªn anh lÃ m tháº¿ nÃ y...",
        "Em Äƒn cÆ¡m chÆ°a? ðŸ™ƒ"
    ];

    const textBox = document.getElementById('textBox');
    const canvas = document.getElementById('heartCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let currentLine = 0;

    function typeLine(line, callback) {
        textBox.innerHTML = "";
        let i = 0;
        const typing = setInterval(() => {
            textBox.innerHTML = line.slice(0, i + 1);
            i++;
            if (i === line.length) {
                clearInterval(typing);
                setTimeout(() => {
                    animateHeartsToText(line, callback);
                }, 500);
            }
        }, 60);
    }

    function animateHeartsToText(message, callback) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.font = "bold 48px 'Segoe UI'";
        ctx.fillStyle = "#ff4d6d";
        ctx.textAlign = "center";
        ctx.fillText(message, canvas.width / 2, canvas.height / 2);

        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        const particles = [];

        for (let y = 0; y < imageData.height; y += 8) {
            for (let x = 0; x < imageData.width; x += 8) {
                const index = (y * imageData.width + x) * 4;
                if (imageData.data[index + 3] > 150) {
                    const startX = Math.random() * canvas.width;
                    const startY = canvas.height + Math.random() * 100;
                    particles.push({
                        x: startX,
                        y: startY,
                        targetX: x,
                        targetY: y,
                        size: 10,
                        speed: 0.05 + Math.random() * 0.05,
                        emoji: 'ðŸ’–'
                    });
                }
            }
        }

        let frame = 0;
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for (let p of particles) {
                p.x += (p.targetX - p.x) * p.speed;
                p.y += (p.targetY - p.y) * p.speed;
                ctx.font = `${p.size}px serif`;
                ctx.fillText(p.emoji, p.x, p.y);
            }
            frame++;
            if (frame < 60) {
                requestAnimationFrame(draw);
            } else {
                setTimeout(callback, 1500);
            }
        }

        draw();
    }

    function runSequence() {
        if (currentLine < lines.length) {
            typeLine(lines[currentLine], () => {
                currentLine++;
                setTimeout(runSequence, 500);
            });
        }
    }

    runSequence();
</script>
</body>
</html>
